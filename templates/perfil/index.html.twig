{% extends 'base.html.twig' %}

{% block body %}
    {% if app.user %}
        <h1 class="mt-3">Bienvenido 
        {% if app.user.getUsername() %}
            {{ app.user.getUsername() }}
        {% else %} 
            {{ app.user.userIdentifier }}
        {% endif %}
    </h1>
    <div class="separador"> </div>
    
    <article class="row justify-content-center">
        <div class="col-md-8 ">
            <div class="foto-usuario text-center ml-3 mb-3">
                {% if app.user.getFoto() %}
                    <img src="{{ asset(app.user.getFoto()) }}" alt="Foto de perfil" class="img-fluid rounded-circle" width="150" height="150">
                {% else %}
                    <img src="{{ asset('img/default-profile.png') }}" alt="Foto de perfil predeterminada" class="img-fluid rounded-circle" width="150" height="150">
                {% endif %}

                <div class="mt-3">
                    <a href="{{ path('profile_edit', {'id': app.user.id}) }}" class="btn btn-primary d-block">Editar perfil</a>
                    {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('sitio_edit') }}" class="btn btn-primary d-block mt-2">Configuración del sitio</a>
                        <a href="{{ path('ayuda') }}" class="btn btn-primary d-block mt-2">Ayuda</a>
                    {% endif %}
                </div>
            </div>
            <div class="card">
                    <h3>Datos Personales</h3>
                    <h4><b> {{ app.user.getUsername() }}</b></h4>
                    <p><strong>Dirección de correo:</strong> {{ app.user.getEmail() }}</p>
                    <p><strong>Nombre:</strong> {{ app.user.getNombre() }}</p>
                    <p><strong>Apellido:</strong> {{ app.user.getApellido() }}</p>
                    <p><strong>Pais: </strong>{{ app.user.getPais() }}</p>
                    <p><strong>Ciudad: </strong>{{ app.user.getCiudad() }}</p>
                    <p><strong>Fecha de nacimiento:</strong> {{ app.user.getFechaNacimiento()|date('d/m/Y') }}</p>
                    <p><strong>Recibir notificaciones:</strong> {{ app.user.isNotificaciones() ? 'Sí' : 'No' }}</p>
            </div>  
        </div>
        <div class="col-md-4 text-left">
            <div class="card">
                <h4>Privacidad y Políticas</h4>
                <p>Resumen de retención de datos</p>
            </div>
        <div class="card">
            <h4>Informes</h4>
            <p>Sesiones del navegador: {{ sesiones|length }}</p>
            <p>Actividad de accesos: {{ actividadAccesos|length }}</p>
            <p>Último acceso al sitio: {{ ultimoAcceso ? ultimoAcceso|date('d/m/Y H:i') : 'No disponible' }}</p>
            <p>Último mensaje en el foro: {{ ultimoMensaje ? ultimoMensaje.createdAt|date('d/m/Y H:i') : 'No disponible' }}</p>
        </div>
  
            <div class="card">
                <h3>Participación en el Foro</h3>
                    <div class="separador"> </div>
                <h4>Mis posts favoritos</h4>
                {% for post in posts %}
                    <div class="post card">
                        <h5>{{ post.title }}</h5> 
                        <p>{{ post.content | raw}}</p> 
                        <p><strong>Categoría:</strong> {{ post.categoria.name }}</p> 
                        <p><small>Fecha de publicación: {{ post.createdAt|date('d/m/Y') }} </small></p>
                        <a href="{{ path('post_show', { 'id': post.id }) }}">Ver post</a>
                    </div>
                {% else %}
                    <p>No tienes posts favoritos.</p>
                {% endfor %}
                    <div class="separador"> </div>
                <h4>Mis últimos cinco posts</h4>
                {% for post in ultimosPosts %}
                     <div class="post card">
                            <h5><a href="{{ path('post_show', { 'id': post.id }) }}">{{ post.title }}</a></h5>
                            <p>En: {{ post.categoria.name }}</p> 
                            <p><small>Fecha de publicación: {{ post.createdAt|date('d/m/Y') }}</small></p>
                    </div>
                    {% else %}
                        <p>No tienes posts recientes.</p>
                    {% endfor %}
                    <div class="separador"> </div>
                <h4>Mis últimos comentarios</h4>
                    {% for comentario in ultimosComentarios %}
                        <div class="post card">
                            <p>{{ comentario.content | raw}}</p>
                            <p><strong>Post:</strong> <a href="{{ path('post_show', { 'id': comentario.post.id }) }}">{{ comentario.post.title }}</a></p>
                            <p>En: {{ comentario.post.categoria.name }}</p> 
                            <p><small>Fecha de publicación: {{ comentario.createdAt|date('d/m/Y') }}</small></p>
                        </div>
                    {% else %}
                        <p>No tienes comentarios recientes.</p>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </article>
{% endif %}
{% endblock %}
